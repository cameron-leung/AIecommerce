<div id="cartPopupOverlay" class="d-none position-fixed z-2 shadow end-0 w-25 overflow-hidden m-2" style="height: 90vh;">
    <div id="cartPopupContent" class="z-3 h-100 w-100 bg-light rounded-3 shadow-sm p-3 overflow-hidden">
        <!-- cart items container -->
        <div id="cartItemsContainer" class="overflow-auto" style="max-height: 70vh;">
            <!-- Cart items will be dynamically added here -->
        </div>

        <!-- total texts -->
        <div class="position-absolute w-90" style="bottom: 60px; right: 10px; left: 10px;">
            <div class="d-flex justify-content-between">
                <h5>Subtotal</h5>
                <h5 id="cart-subtotal"></h5>
            </div>
            <div class="d-flex justify-content-between">
                <h5>Tax + Fees</h5>
                <h5 id="cart-tax"></h5>
            </div>
        </div>

        <!-- checkout button -->
        <div>
            <button id="checkoutButton" class="d-block position-absolute px-1 py-2 bottom-0 mb-3 w-75 bg-light rounded-2 translate-middle-x" style="left: 50%; color: #FF206E; border-color: #FF206E;">Checkout</button>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="AIecommerce.js"></script>
<script>
    $(document).ready(function() {

        // Event listener for checkbox delegation
	    $(document).on('click', '#check-icon', function() {
	        $(this).toggleClass("fa-square fa-square-check");
	    });
	 	// Event listener for trash
	    $(document).on('click', '.fa-trash', function() {
	        var chatterName = $(this).attr('id'); 
	        console.log(chatterName);
	        removeFromCart(chatterName);
	    });

        // Event listener for the checkout button
        $('#checkoutButton').on('click', function() {
            window.location.href = 'purchasepage.html';
        });
    });
    var cartPopupOpen = false;
 	// Open the cart popup
    function openCartPopup() {
	 if(!cartPopupOpen){
        $('#cartPopupOverlay').removeClass('d-none').fadeIn();
        fetchCartItems();
        cartPopupOpen = true;
	 }
    }
    // Close the cart popup
    function closeCartPopup() {
        $('#cartPopupOverlay').addClass('d-none').fadeOut();
        cartPopupOpen = false;
    }
    // Event listener for the icon click to open the popup and add to cart
    $('.openCartPopupIcon').on('click', function(event) {
    	fetchCartItems(); // Fetch and display cart items
    	openCartPopup();
        event.stopPropagation(); // Prevent event propagation
    });
    // Close the cart popup when clicking outside
    $(document).on('click', function(event) {
        if (cartPopupOpen && !$(event.target).closest('#cartPopupContent').length) {
            closeCartPopup();
        }
    });
    
 
    
    
    function removeFromCart(name) {
        $.ajax({
            url: '/removeFromCart',
            type: 'POST',
            contentType: 'text/plain', // Specify the content type
            data: name, // Convert the Chatter object to JSON
            success: function(response) {
                console.log(response); // Handle success response as needed
                fetchCartItems(); // Refresh cart items after removal
            },
            error: function(xhr, status, error) {
                console.error('Failed to remove item from cart', error);
            }
        });
    }
    
</script>
