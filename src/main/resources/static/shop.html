<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop All Page</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href='https://fonts.googleapis.com/css?family=DM Sans' rel='stylesheet'>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<style>
	/* invisible & sizing & z-index for filter overlay */
	#filterPopupOverlay {
        display: none;
        position: fixed;
        top:80px;
        left: 10px;
        width:25%;
        height: 80%;
		padding: 10px;
        z-index: 999;
    }
    /* filter overlay content */
    #filterPopupContent {
        background-color: #fff;
        padding: 10px;
        border-radius: 8px;
		border-color: grey;
		box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
		width: 100%;
		height: 100%;
		margin: 0;
		position: relative;
    }
    
	/* filter overlay price slider size */
	.price-slider {
	    -webkit-appearance: none;
	    appearance: none;
	    width: 100%;
	    height: 15px;
	    border-radius: 10px;
	    background: #DADADA;
	    outline: none;
	    opacity: 0.7;
	    transition: opacity .2s;
	}
	/* filter overlay price slider marker */
	.price-slider::-webkit-slider-thumb {
	    -webkit-appearance: none;
	    appearance: none;
	    width: 25px;
	    height: 25px;
	    border-radius: 50%;
	    background: #FF206E;
	    cursor: pointer;
	    margin-top: -5px;
	    z-index: 2;
	}
	/* filter overlay price slider bar */
	.price-slider::-webkit-slider-runnable-track {
	    background: linear-gradient(to right, #FF206E 0%, #FF206E var(--thumb-position), #DADADA var(--thumb-position), #DADADA 100%);
	    border-radius: 10px;
	    height: 15px;
	}
	/* Firefox */
	.price-slider::-moz-range-thumb {
	    width: 25px;
	    height: 25px;
	    border-radius: 50%;
	    background: #FF206E;
	    cursor: pointer;
	}
	.price-slider::-moz-range-track {
	    background: linear-gradient(to right, #FF206E 0%, #FF206E var(--thumb-position), #DADADA var(--thumb-position), #DADADA 100%);
	    border-radius: 10px;
	    height: 15px;
	}
	/* IE */
	.price-slider::-ms-thumb {
	    width: 25px;
	    height: 25px;
	    border-radius: 50%;
	    background: #FF206E;
	    cursor: pointer;
	}
	.price-slider::-ms-track {
	    background: transparent;
	    border-color: transparent;
	    border-width: 15px 0;
	    color: transparent;
	    height: 15px;
	}
	.price-slider::-ms-fill-lower {
	    background: #FF206E;
	    border-radius: 10px;
	}
	.price-slider::-ms-fill-upper {
	    background: #DADADA;
	    border-radius: 10px;
	}


	/* checkboxes on filter overlay */
    .checkbox-item {
        margin-bottom: 5px;
    }
    .checkbox-item input[type="checkbox"] {
        margin-right: 5px; 
    }
</style>

<body> 
	<!-- Navbar -->
	<div id="navbar-placeholder"></div> 
	<!-- Shop all page body content -->
	<div class = "px-5 ">
	
		<!-- Header & back button -->
		<div class = "d-flex col">
			<div class = "icons">
				<div id="backButton" class="d-inline-block py-1 px-3 text-center align-items-center"><i class="fs-2 fa-solid fa-chevron-left"></i></div>
			</div>
			<h1>Shop</h1>
		</div>
		
		<!-- Filter button -->
		<div class = "pb-2">
			<button id="openFilterPopupIcon" class="w-auto h-auto text-black bg-light border-0 rounded fs-5">
			    <i id="openFilterPopupIcon" class="fa-solid fa-filter"></i>
			    <span>Filter</span>
			</button>
			
		</div>
		
		<!-- Chatter cards in rows -->
		<div class="row">
		    <div class="col">
		        <div class="d-flex flex-wrap" style="width: 100%;">
					<div class="character-card-container d-flex flex-row flex-wrap justify-content-start"></div>
		         </div>
		    </div>
		</div>
	
		<!-- Filter overlay -->
		<div id="filterPopupOverlay">
		    <div id="filterPopupContent">
		        <h2>Price</h2>
		        <div style="width: 300px; margin: 20px auto;">
				    <input type="range" min="0" max="100" value="50" class="price-slider" id="priceRange">
				    <div class="text-center mt-1">Range: 0 - <span id="priceValue">$50</span></div>
				    <h2>Category</h2>
				    <ul class="p-0">
					    <div class="checkbox-item">
					        <input type="checkbox" value="Animal">
					        <label for="checkbox1">Animal</label>
					    </div>
					    <div class="checkbox-item">
					        <input type="checkbox" value="Comedy">
					        <label for="checkbox3">Comedy</label>
					    </div>
					    <div class="checkbox-item">
					        <input type="checkbox" value="Helpful">
					        <label for="checkbox7">Helpful</label>
					    </div>
					    <div class="checkbox-item">
					        <input type="checkbox" value="Personal">
					        <label for="checkbox8">Personal</label>
					    </div>
					    <div class="checkbox-item">
					        <input type="checkbox"  value="Public Figures">
					        <label for="checkbox10">Public Figures</label>
					    </div>
					    <div class="checkbox-item">
					        <input type="checkbox" value="Role Play">
					        <label for="checkbox11">Role Play</label>
					    </div>
					</ul>
				</div>
			</div>
			<div>
				<button id="applyButton" class="d-block position-absolute px-1 py-2 bottom-0 mb-3 w-75 bg-light rounded-2 translate-middle-x" style="left: 50%; color: #FF206E; border-color: #FF206E;">Apply</button>
			</div>
		</div>
		
		
		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
		<script src="characterData.js"></script>
		<script>
		document.getElementById('backButton').addEventListener('click', function() {
            window.history.back();
        });

        $(document).ready(function() {
            var filterPopupOpen = false;

            function openFilterPopup() {
                $('#filterPopupOverlay').fadeIn();
                filterPopupOpen = true;
            }

            function closeFilterPopup() {
                $('#filterPopupOverlay').fadeOut();
                filterPopupOpen = false;
            }

            $(document).on('click', function(event) {
                var $target = $(event.target);
                if (filterPopupOpen && !$target.closest('#filterPopupContent').length && !$target.is('#filterPopupContent')) {
                    closeFilterPopup();
                }
            });

            $('#filterPopupContent').on('click', function(event) {
                event.stopPropagation();
            });

            $(document).on('click', '#openFilterPopupIcon', function(event) {
                event.stopPropagation();
                openFilterPopup();
            });

            $('#navbar-placeholder').load('navbar.html', function() {
                $('.discover-icon').addClass('active');
            });

            const container = $('.character-card-container');
            const filterLabelsContainer = $('#filterLabelsContainer');

            // Function to populate card
            function populateCard(template, character) {
                const imageName = character.name.replace(/\s+/g, '');
                return template
                    .replace('RECT_IMAGE_URL', 'images/' + imageName + 'Rectangle.png')
                    .replace('NAME', character.name)
                    .replace('USERNAME', character.username)
                    .replace('PRICE', character.price)
                    .replace('BLURB', character.blurb);
            }

            // Function to filter character data based on categories and price
            function filterCharacterData(selectedCategories = [], selectedPrice = 100) {
                const filteredData = characterData
                    .filter(character => {
                        const matchesCategory = selectedCategories.length === 0 || character.category.some(cat => selectedCategories.includes(cat));
                        const matchesPrice = parseFloat(character.price.replace('$', '')) <= selectedPrice || character.price === 'Free';
                        return matchesCategory && matchesPrice;
                    });

                // Display filtered data
                container.empty();
                $.get('chattercard.html', function(template) {
                    if (filteredData.length === 0) {
                        console.error(`No data found for selected filters`);
                    }
                    filteredData.forEach(character => {
                        const populatedCard = populateCard(template, character);
                        container.append(populatedCard);
                    });
                }).fail(function() {
                    console.error("Failed to load chattercard.html");
                });
            }

            // Function to update filter labels
            function updateFilterLabels(selectedCategories) {
                filterLabelsContainer.empty();
                selectedCategories.forEach(category => {
                    const label = $('<div class="filter-label">' + category + '<span class="remove-label">&times;</span></div>');
                    label.find('.remove-label').on('click', function() {
                        const index = selectedCategories.indexOf(category);
                        if (index > -1) {
                            selectedCategories.splice(index, 1);
                            filterCharacterData(selectedCategories, parseFloat($('#priceRange').val()));
                            updateFilterLabels(selectedCategories);
                            $('input[type=checkbox][value="' + category + '"]').prop('checked', false);
                        }
                    });
                    filterLabelsContainer.append(label);
                });
            }

            // Event listener for the apply button
            $('#applyButton').on('click', function() {
                // Get selected categories
                const selectedCategories = [];
                $('input[type=checkbox]:checked').each(function() {
                    selectedCategories.push($(this).val());
                });

                // Get selected price
                const selectedPrice = parseFloat($('#priceRange').val());

                // Apply filters
                filterCharacterData(selectedCategories, selectedPrice);
                updateFilterLabels(selectedCategories);
                closeFilterPopup();
            });

            // Initial data load based on URL category
            const urlParams = new URLSearchParams(window.location.search);
            const category = urlParams.get('category') || 'All';
            const initialCategories = category === 'All' ? [] : [category];

            filterCharacterData(initialCategories);
            updateFilterLabels(initialCategories);

            // Check the checkboxes for the initial categories
            initialCategories.forEach(category => {
                $('input[type=checkbox][value="' + category + '"]').prop('checked', true);
            });
        });

	    </script>
	</div>
</body>
